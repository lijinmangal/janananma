{% extends "base.html" %}
{% load custom_filters %}
{% block content %}
<div class="container">
    <h2 class="mb-4">Daily Purchase Entry</h2>
    <form method="POST">
        {% csrf_token %}
        <table class="table table-bordered table-striped">
            <thead class="table-primary">
                <tr>
                    <th>Wholesaler</th>
                    <th>Previous Credit</th>
                    <th>Bill Number</th>
                    <th>Bill Amount</th>
                    <th>Paid Amount</th>
                    <th>Credit Left</th>
                </tr>
            </thead>
            <tbody>
                {% for wholesaler in wholesalers %}
                <tr>
                    <td>{{ wholesaler.name }}</td>
                    <td>
                        <input type="number" step="0.01" name="wholesaler_{{ wholesaler.id }}_previous_credit"
                               value="{{ previous_credits|get_item:wholesaler.id }}" class="form-control" readonly>
                    </td>
                    <td><input type="text" name="wholesaler_{{ wholesaler.id }}_bill_number" class="form-control"></td>
                    <td><input type="number" step="0.01" name="wholesaler_{{ wholesaler.id }}_bill_amount" class="form-control bill-amount"></td>
                    <td><input type="number" step="0.01" name="wholesaler_{{ wholesaler.id }}_paid_amount" class="form-control paid-amount"></td>
                    <td><input type="number" step="0.01" name="wholesaler_{{ wholesaler.id }}_credit_left" class="form-control credit-left"></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="mt-4">
            <h5>Summary</h5>
            <p>Total Purchase: ₹<span id="total-bill">0</span></p>
            <p>Total Paid: ₹<span id="total-paid">0</span></p>
            <p>Total Credit Left: ₹<span id="total-credit">0</span></p>
        </div>

        <button type="submit" class="btn btn-success">Submit</button>
    </form>
</div>

<script>
    function calculateTotals() {
        let totalBill = 0, totalPaid = 0, totalCredit = 0;
        document.querySelectorAll('.bill-amount').forEach(el => totalBill += parseFloat(el.value || 0));
        document.querySelectorAll('.paid-amount').forEach(el => totalPaid += parseFloat(el.value || 0));
        document.querySelectorAll('.credit-left').forEach(el => totalCredit += parseFloat(el.value || 0));

        document.getElementById('total-bill').innerText = totalBill.toFixed(2);
        document.getElementById('total-paid').innerText = totalPaid.toFixed(2);
        document.getElementById('total-credit').innerText = totalCredit.toFixed(2);
    }

    document.querySelectorAll('input').forEach(el => el.addEventListener('input', calculateTotals));
    calculateTotals();
</script>
{% endblock %}
